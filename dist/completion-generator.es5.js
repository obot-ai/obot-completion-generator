var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};function t(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}function r(e,t,r,a){return new(r||(r=Promise))((function(n,o){function i(e){try{u(a.next(e))}catch(e){o(e)}}function c(e){try{u(a.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,c)}u((a=a.apply(e,t||[])).next())}))}function a(e,t){var r,a,n,o,i={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(c){return function(u){return function(c){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(i=0)),i;)try{if(r=1,a&&(n=2&c[0]?a.return:c[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,c[1])).done)return n;switch(a=0,n&&(c=[2&c[0],n.value]),c[0]){case 0:case 1:n=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,a=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(n=i.trys,(n=n.length>0&&n[n.length-1])||6!==c[0]&&2!==c[0])){i=0;continue}if(3===c[0]&&(!n||c[1]>n[0]&&c[1]<n[3])){i.label=c[1];break}if(6===c[0]&&i.label<n[1]){i.label=n[1],n=c;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(c);break}n[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],a=0}finally{r=n=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,u])}}}"function"==typeof SuppressedError&&SuppressedError;var n=function(){function e(e){void 0===e&&(e={}),Object.defineProperty(this,"keywordSeparator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"minKeywordLength",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"strictMatchLocales",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"comparator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxResults",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keywordSeparator=e.keywordSeparator||",",this.minKeywordLength=e.minKeywordLength||2,this.strictMatchLocales=e.strictMatchLocales||["en"],e.maxResults&&(this.maxResults=e.maxResults),"function"==typeof e.comparator&&(this.comparator=e.comparator),"function"==typeof e.filter&&(this.filter=e.filter),this.data=new Map}return Object.defineProperty(e.prototype,"loadData",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){this.data.set(e,t)}}),Object.defineProperty(e.prototype,"match",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return[]}}),e}(),o=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t(r,e),Object.defineProperty(r.prototype,"match",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=this.data.get(t);if(!r)return[];var a=Array.from(r);if(this.comparator){var n=this.comparator;a.sort((function(r,a){return n(r,a,e,t)}))}return this.filter?(0,this.filter)(a,e,t):this._match(a,e.toLowerCase(),t)}}),Object.defineProperty(r.prototype,"_match",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){var a=-1!==this.strictMatchLocales.indexOf(r),n=[];if(e)for(var o=0,i=e;o<i.length;o++){var c=i[o],u=void 0;if((u=a?this._wordMatch(c,t):this._charMatch(c,t)).isMatched&&u.data&&n.push(u.data),this.maxResults&&n.length>=this.maxResults)break}return n}}),Object.defineProperty(r.prototype,"_charMatch",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){for(var r=e.text.toLowerCase(),a=e.keywords.toLowerCase(),n=this.minKeywordLength||2,o=t.length,i=[],c=0;c<o;){var u="",s=t[c];if(-1!==a.indexOf(s)){var l=c;if(u=s,l<o-1)for(l+=1;l<o;){var f=u+t[l];if(-1===a.indexOf(f)){l-=1;break}u=f,l+=1}u.length>=n&&i.push({text:u,startAt:c,endAt:l}),c=l+1}else{if(-1===r.indexOf(s))return{isMatched:!1};c+=1}}for(var h=[],p=0,d=null,y=null;p<i.length;){y=i[p];var b=(null==d?void 0:d.endAt)||0,m=y.startAt;m>b&&h.push(t.slice(b+1,m)),d=y,p+=1}if(0===p)h.push(t);else if(y){var v=y.endAt;v+1<o&&h.push(t.slice(v+1,o))}var w=h.every((function(e){return-1!==r.indexOf(e)}));return{isMatched:w,data:{text:e.text,keywords:e.keywords,matchedKeywords:i}}}}),Object.defineProperty(r.prototype,"_wordMatch",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=e.text.toLowerCase(),a=this.keywordSeparator||",",n=[];e.keywords.toLowerCase().split(a).forEach((function(e){e.split(" ").forEach((function(e){n.push(e)}))}));var o=t.split(" "),i=o.pop();if(!(-1!==r.indexOf(i)||n.some((function(e){return-1!==e.indexOf(i)}))))return{isMatched:!1};var c=o.filter((function(e){return-1!==n.indexOf(e)})).map((function(e){var r=t.indexOf(e);return{text:e,startAt:r,endAt:r+e.length}}));return{isMatched:o.filter((function(e){return-1===n.indexOf(e)})).every((function(e){return-1!==r.indexOf(e)})),data:{text:e.text,keywords:e.keywords,matchedKeywords:c}}}}),r}(n),i=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return Object.defineProperty(t,"exactRegExpMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(t,"partialRegExpMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),t}return t(r,e),Object.defineProperty(r.prototype,"loadData",{enumerable:!1,configurable:!0,writable:!0,value:function(t,r){var a=this;e.prototype.loadData.call(this,t,r);var n=new Set;r.forEach((function(e){e.keywords.split(a.keywordSeparator).forEach((function(e){e.length>0&&n.add(e.toLowerCase())}))}));var o=Array.from(n);o.sort((function(e,t){return t.length-e.length})),this.exactRegExpMap.set(t,new RegExp(o.join("|"),"g"));var i=[];o.forEach((function(e){if(e.length>a.minKeywordLength){var t=e.slice(0,a.minKeywordLength),r=[t];(n=e.length-a.minKeywordLength,o=a.minKeywordLength,Array.from(Array(n).keys()).map((function(e){return e+o}))).forEach((function(a){t+=e[a],r.push(t)})),r.reverse(),i.push(r.join("|"))}else e.length>0&&i.push(e);var n,o})),this.partialRegExpMap.set(t,new RegExp(i.join("|"),"g"))}}),Object.defineProperty(r.prototype,"match",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=this.data.get(t);if(!r)return[];var a=Array.from(r);if(this.comparator){var n=this.comparator;a.sort((function(r,a){return n(r,a,e,t)}))}return this._match(a,e,t)}}),Object.defineProperty(r.prototype,"_match",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){var a=[],n=this.exactRegExpMap.get(r);if(e&&n){var o=void 0;if(!(o=t.toLowerCase().match(n))){var i=this.partialRegExpMap.get(r);i&&(o=t.toLowerCase().match(i))}if(o)for(var c=o.map((function(e){var r=t.indexOf(e);return{text:e,startAt:r,endAt:r+e.length}})),u=function(e){var t=[],r=e.keywords;if(c.forEach((function(e){-1!==r.indexOf(e.text)&&t.push(e)})),t.length>0&&a.push({text:e.text,keywords:e.keywords,matchedKeywords:t}),s.maxResults&&a.length>=s.maxResults)return"break"},s=this,l=0,f=e;l<f.length;l++){if("break"===u(f[l]))break}}return a}}),r}(n),c=function(e){function r(t){var r=e.call(this,t)||this;return Object.defineProperty(r,"matchers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),r.matchers=[],r}return t(r,e),Object.defineProperty(r.prototype,"addMatcherByClass",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=new e({keywordSeparator:this.keywordSeparator,minKeywordLength:this.minKeywordLength,strictMatchLocales:this.strictMatchLocales,comparator:this.comparator});this.addMatcher(t)}}),Object.defineProperty(r.prototype,"addMatcher",{enumerable:!1,configurable:!0,writable:!0,value:function(e){"function"==typeof e.loadData&&"function"==typeof e.match&&this.matchers.push(e)}}),Object.defineProperty(r.prototype,"loadData",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=JSON.stringify(t);this.matchers.forEach((function(t){t.loadData(e,JSON.parse(r))}))}}),Object.defineProperty(r.prototype,"match",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){for(var r=[],a=0,n=this.matchers;a<n.length;a++){for(var o=n[a].match(e,t),i=function(e){if(r.some((function(t){return t.text===e.text}))||r.push(e),c.maxResults&&r.length>=c.maxResults)return"break"},c=this,u=0,s=o;u<s.length;u++){if("break"===i(s[u]))break}if(this.maxResults&&r.length>=this.maxResults)break}return r}}),r}(n),u=function(e){function r(t){var r=e.call(this,t)||this;return r.addMatcher(new i(t)),r.addMatcher(new o(t)),r}return t(r,e),r}(c),s=o,l=function(){function e(e){void 0===e&&(e={keywordSeparator:",",minKeywordLength:2,strictMatchLocales:["en"]}),Object.defineProperty(this,"matcher",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e.matcher?this.matcher=e.matcher:this.matcher=new s({keywordSeparator:e.keywordSeparator||",",minKeywordLength:e.minKeywordLength||2,strictMatchLocales:e.strictMatchLocales||["en"],comparator:e.comparator,filter:e.filter})}return Object.defineProperty(e.prototype,"loadData",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){this._validateLocaleData(t),this.matcher.loadData(e,t)}}),Object.defineProperty(e.prototype,"_validateLocaleData",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(!Array.isArray(e)||!e.every((function(e){return"string"==typeof e.text&&"string"==typeof e.keywords})))throw Error("Locale data should be a list of {text: string, keywords: string}")}}),Object.defineProperty(e.prototype,"generateCompletions",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return!e||e.length<=0?[]:this.matcher.match(e,t)}}),Object.defineProperty(e.prototype,"keywordSeparator",{get:function(){return this.matcher.keywordSeparator},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"minKeywordLength",{get:function(){return this.matcher.minKeywordLength},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"strictMatchLocales",{get:function(){return this.matcher.strictMatchLocales},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this.matcher.data},enumerable:!1,configurable:!0}),e}(),f=function(){function e(e){void 0===e&&(e={apiKey:""}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKeyHeaderName",{enumerable:!0,configurable:!0,writable:!0,value:"X-Secret-Key"}),Object.defineProperty(this,"getEndpoint",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"handleResponse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.apiKey=e.apiKey,e.apiKeyHeaderName&&(this.apiKeyHeaderName=e.apiKeyHeaderName),"function"==typeof e.getEndpoint?this.getEndpoint=e.getEndpoint:this.getEndpoint=function(e){return"/input_completion/".concat(e,"/")},"function"==typeof e.handleResponse?this.handleResponse=e.handleResponse:this.handleResponse=function(e){if("user_says"in e&&Array.isArray(e.user_says))return e.user_says;throw Error("Data should have [user_says](Array<text,keywords>)")}}return Object.defineProperty(e.prototype,"fetch",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this,n=this.getEndpoint(e);return new Promise((function(e,o){return r(t,void 0,void 0,(function(){var t,r,i;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this._fetch(n)];case 1:t=a.sent();try{r=this.handleResponse(t),e(r)}catch(e){o("Invalid data fetched. ".concat(JSON.stringify(t)))}return"user_says"in t&&Array.isArray(t.user_says),[3,3];case 2:return i=a.sent(),o("Failed to fetch data from ".concat(n,".")),console.error(i),[3,3];case 3:return[2]}}))}))}))}}),Object.defineProperty(e.prototype,"_fetch",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this;return new Promise((function(n,o){return r(t,void 0,void 0,(function(){var t,r,i,c,u;return a(this,(function(a){switch(a.label){case 0:return this.isFetchAvailable()?(t={},this.apiKey&&((r={})[this.apiKeyHeaderName]=this.apiKey,t.headers=r),[4,fetch(e,t)]):[3,5];case 1:return(i=a.sent()).ok&&200==i.status?[4,i.json()]:[3,3];case 2:return c=a.sent(),n(c),[3,4];case 3:o("Failed to fetch data. Status: ".concat(i.status)),a.label=4;case 4:return[3,6];case 5:(u=new XMLHttpRequest).open("GET",e),this.apiKey&&u.setRequestHeader(this.apiKeyHeaderName,this.apiKey),u.onload=function(){if(200===u.status)try{var e=JSON.parse(u.response);n(e)}catch(e){o("Invalid response data format.")}else o("Failed to fetch data. Status: ".concat(u.status))},u.onerror=function(){o("Unknown error occurred while fetching completion data.")},u.send(),a.label=6;case 6:return[2]}}))}))}))}}),Object.defineProperty(e.prototype,"isFetchAvailable",{enumerable:!1,configurable:!0,writable:!0,value:function(){return"function"==typeof window.fetch}}),e}();export{c as ConcatMatcher,s as DefaultMatcher,f as Fetcher,o as ForwardMatcher,l as Generator,u as KeywordForwardMatcher,i as KeywordMatcher,n as Matcher};
