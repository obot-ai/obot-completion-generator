function e(e,t,r,n){return new(r||(r=Promise))((function(a,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}c((n=n.apply(e,t||[])).next())}))}function t(e,t){var r,n,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(o=0)),o;)try{if(r=1,n&&(a=2&s[0]?n.return:s[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,s[1])).done)return a;switch(n=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,n=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){o.label=s[1];break}if(6===s[0]&&o.label<a[1]){o.label=a[1],a=s;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(s);break}a[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],n=0}finally{r=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}"function"==typeof SuppressedError&&SuppressedError;var r=function(){function e(e){void 0===e&&(e={keywordSeparator:",",minKeywordLength:2,strictMatchLocales:["en"]}),Object.defineProperty(this,"keywordSeparator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"minKeywordLength",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"strictMatchLocales",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"comparator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keywordSeparator=e.keywordSeparator||",",this.minKeywordLength=e.minKeywordLength||2,this.data=new Map,this.strictMatchLocales=e.strictMatchLocales||["en"],"function"==typeof e.comparator&&(this.comparator=e.comparator),"function"==typeof e.filter&&(this.filter=e.filter)}return Object.defineProperty(e.prototype,"loadData",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){this._validateLocaleData(t),this.data.set(e,t)}}),Object.defineProperty(e.prototype,"_validateLocaleData",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(!Array.isArray(e)||!e.every((function(e){return"string"==typeof e.text&&"string"==typeof e.keywords})))throw Error("Locale data should be a list of {text: string, keywords: string}")}}),Object.defineProperty(e.prototype,"generateCompletions",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){if(!e||e.length<=0)return[];var r=this.data.get(t);if(!r)return[];var n=Array.from(r);if(this.comparator){var a=this.comparator;n.sort((function(r,n){return a(r,n,e,t)}))}return this.filter?(0,this.filter)(n,e,t):this._getMatchedCompletions(n,e,t)}}),Object.defineProperty(e.prototype,"_getMatchedCompletions",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){var n=this,a=-1!==this.strictMatchLocales.indexOf(r),i=[];return e.forEach((function(e){var r=null;(r=a?n._strictMatch(e,t.toLowerCase()):n._match(e,t.toLowerCase())).isMatched&&r.data&&i.push(r.data)})),i}}),Object.defineProperty(e.prototype,"_match",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){for(var r=e.text.toLowerCase(),n=e.keywords.toLowerCase(),a=t.length,i=[],o=0;o<a;){var s="",c=t[o];if(-1!==n.indexOf(c)){var u=o;if(s=c,u<a-1)for(u+=1;u<a;){var l=s+t[u];if(-1===n.indexOf(l)){u-=1;break}s=l,u+=1}s.length>=this.minKeywordLength&&i.push({text:s,startAt:o,endAt:u}),o=u+1}else{if(-1===r.indexOf(c))return{isMatched:!1};o+=1}}for(var f=[],d=0,h=null,p=null;d<i.length;){p=i[d];var y=(null==h?void 0:h.endAt)||0,b=p.startAt;b>y&&f.push(t.slice(y+1,b)),h=p,d+=1}if(0===d)f.push(t);else if(p){var v=p.endAt;v+1<a&&f.push(t.slice(v+1,a))}var w=f.every((function(e){return-1!==r.indexOf(e)}));return{isMatched:w,data:{text:e.text,keywords:e.keywords,matchedKeywords:i}}}}),Object.defineProperty(e.prototype,"_strictMatch",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=e.text.toLowerCase(),n=[];e.keywords.toLowerCase().split(this.keywordSeparator).forEach((function(e){e.split(" ").forEach((function(e){n.push(e)}))}));var a=t.split(" "),i=a.pop();if(!(-1!==r.indexOf(i)||n.some((function(e){return-1!==e.indexOf(i)}))))return{isMatched:!1};var o=a.filter((function(e){return-1!==n.indexOf(e)})).map((function(e){var r=t.indexOf(e);return{text:e,startAt:r,endAt:r+e.length}}));return{isMatched:a.filter((function(e){return-1===n.indexOf(e)})).every((function(e){return-1!==r.indexOf(e)})),data:{text:e.text,keywords:e.keywords,matchedKeywords:o}}}}),e}(),n=function(){function r(e){void 0===e&&(e={apiKey:""}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKeyHeaderName",{enumerable:!0,configurable:!0,writable:!0,value:"X-Secret-Key"}),Object.defineProperty(this,"getEndpoint",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"handleResponse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.apiKey=e.apiKey,e.apiKeyHeaderName&&(this.apiKeyHeaderName=e.apiKeyHeaderName),"function"==typeof e.getEndpoint?this.getEndpoint=e.getEndpoint:this.getEndpoint=function(e){return"/input_completion/".concat(e,"/")},"function"==typeof e.handleResponse?this.handleResponse=e.handleResponse:this.handleResponse=function(e){if("user_says"in e&&Array.isArray(e.user_says))return e.user_says;throw Error("Data should have [user_says](Array<text,keywords>)")}}return Object.defineProperty(r.prototype,"fetch",{enumerable:!1,configurable:!0,writable:!0,value:function(r){var n=this,a=this.getEndpoint(r);return new Promise((function(r,i){return e(n,void 0,void 0,(function(){var e,n,o;return t(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this._fetch(a)];case 1:e=t.sent();try{n=this.handleResponse(e),r(n)}catch(t){i("Invalid data fetched. ".concat(JSON.stringify(e)))}return"user_says"in e&&Array.isArray(e.user_says),[3,3];case 2:return o=t.sent(),i("Failed to fetch data from ".concat(a,".")),console.error(o),[3,3];case 3:return[2]}}))}))}))}}),Object.defineProperty(r.prototype,"_fetch",{enumerable:!1,configurable:!0,writable:!0,value:function(r){var n=this;return new Promise((function(a,i){return e(n,void 0,void 0,(function(){var e,n,o,s,c;return t(this,(function(t){switch(t.label){case 0:return this.isFetchAvailable()?(e={},this.apiKey&&((n={})[this.apiKeyHeaderName]=this.apiKey,e.headers=n),[4,fetch(r,e)]):[3,5];case 1:return(o=t.sent()).ok&&200==o.status?[4,o.json()]:[3,3];case 2:return s=t.sent(),a(s),[3,4];case 3:i("Failed to fetch data. Status: ".concat(o.status)),t.label=4;case 4:return[3,6];case 5:(c=new XMLHttpRequest).open("GET",r),this.apiKey&&c.setRequestHeader(this.apiKeyHeaderName,this.apiKey),c.onload=function(){if(200===c.status)try{var e=JSON.parse(c.response);a(e)}catch(e){i("Invalid response data format.")}else i("Failed to fetch data. Status: ".concat(c.status))},c.onerror=function(){i("Unknown error occurred while fetching completion data.")},c.send(),t.label=6;case 6:return[2]}}))}))}))}}),Object.defineProperty(r.prototype,"isFetchAvailable",{enumerable:!1,configurable:!0,writable:!0,value:function(){return"function"==typeof window.fetch}}),r}();export{n as Fetcher,r as Generator};
