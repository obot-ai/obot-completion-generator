var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};function t(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}function r(e,t,r,a){return new(r||(r=Promise))((function(n,o){function i(e){try{s(a.next(e))}catch(e){o(e)}}function c(e){try{s(a.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,c)}s((a=a.apply(e,t||[])).next())}))}function a(e,t){var r,a,n,o,i={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(c){return function(s){return function(c){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(i=0)),i;)try{if(r=1,a&&(n=2&c[0]?a.return:c[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,c[1])).done)return n;switch(a=0,n&&(c=[2&c[0],n.value]),c[0]){case 0:case 1:n=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,a=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(n=i.trys,(n=n.length>0&&n[n.length-1])||6!==c[0]&&2!==c[0])){i=0;continue}if(3===c[0]&&(!n||c[1]>n[0]&&c[1]<n[3])){i.label=c[1];break}if(6===c[0]&&i.label<n[1]){i.label=n[1],n=c;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(c);break}n[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],a=0}finally{r=n=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}"function"==typeof SuppressedError&&SuppressedError;var n=function(e,t){return e.text===t.text&&e.startAt===t.startAt&&e.endAt===t.endAt},o=function(){function e(e){void 0===e&&(e={}),Object.defineProperty(this,"keywordSeparator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"minKeywordLength",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"strictMatchLocales",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"comparator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"scorer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxResults",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keywordSeparator=e.keywordSeparator||",",this.minKeywordLength=e.minKeywordLength||2,this.strictMatchLocales=e.strictMatchLocales||["en"],e.maxResults&&(this.maxResults=e.maxResults),"function"==typeof e.comparator&&(this.comparator=e.comparator),"function"==typeof e.filter&&(this.filter=e.filter),"function"!=typeof e.scorer&&null!==e.scorer||(this.scorer=e.scorer),"function"!=typeof e.sort&&null!==e.sort||(this.sort=e.sort),this.data=new Map}return Object.defineProperty(e.prototype,"loadData",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){this.data.set(e,t)}}),Object.defineProperty(e.prototype,"match",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=this._match(e,t);return this._scoreResults(r,e,t),this._sortResults(r,e,t),this.maxResults&&this.maxResults>0?r.slice(0,this.maxResults):r}}),Object.defineProperty(e.prototype,"_match",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return[]}}),Object.defineProperty(e.prototype,"_scoreResults",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){var a=null;if(this.scorer?a=this.scorer.bind(this):null!==this.scorer&&(a=this._defaultScorer.bind(this)),a)for(var n=0,o=e;n<o.length;n++){var i=o[n];i.score=a(i,t,r)}}}),Object.defineProperty(e.prototype,"_defaultScorer",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){var a=e.text.toLowerCase(),n=0;if(e.matchedKeywords){n+=10*e.matchedKeywords.length;for(var o=0,i=e.matchedKeywords;o<i.length;o++){var c=i[o].text.toLowerCase(),s=0;-1!==a.indexOf(c)&&(s=c.length),n+=s}}return e.noKeywordMatchedLength&&(n+=e.noKeywordMatchedLength),n}}),Object.defineProperty(e.prototype,"_sortResults",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){var a=null;this.sort?a=this.sort.bind(this):null!==this.sort&&(a=this._defaultSort.bind(this)),a&&e.sort((function(e,n){return a(e,n,t,r)}))}}),Object.defineProperty(e.prototype,"_defaultSort",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,a){return e.score&&t.score?t.score-e.score:0}}),e}(),i=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t(r,e),Object.defineProperty(r.prototype,"_match",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=this.data.get(t);if(!r)return[];var a=Array.from(r);if(this.comparator){var n=this.comparator;a.sort((function(r,a){return n(r,a,e,t)}))}return this.filter?(0,this.filter)(a,e,t):this._forwardMatch(a,e.toLowerCase(),t)}}),Object.defineProperty(r.prototype,"_forwardMatch",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){var a=-1!==this.strictMatchLocales.indexOf(r),n=[];if(e)for(var o=0,i=e;o<i.length;o++){var c=i[o],s=void 0;(s=a?this._wordMatch(c,t):this._charMatch(c,t)).isMatched&&s.data&&n.push(s.data)}return n}}),Object.defineProperty(r.prototype,"_charMatch",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){for(var r=e.text.toLowerCase(),a=e.keywords.toLowerCase(),n=this.minKeywordLength||2,o=t.length,i=[],c=0;c<o;){var s="",u=t[c];if(-1!==a.indexOf(u)){var l=c;if(s=u,l<o-1){for(l+=1;l<o;){var f=s+t[l];if(-1===a.indexOf(f)){l-=1;break}s=f,l+=1}l===o&&(l-=1)}s.length>=n&&i.push({text:s,startAt:c,endAt:l}),c=l+1}else{if(-1===r.indexOf(u))return{isMatched:!1};c+=1}}for(var h=[],d=0,p=null,y=null;d<i.length;){y=i[d];var b=(null==p?void 0:p.endAt)||-1,w=y.startAt;w>b+1&&h.push({text:t.slice(b+1,w),startAt:b+1,endAt:w-1}),p=y,d+=1}if(0===d)h.push({text:t,startAt:0,endAt:o-1});else if(y){var m=y.endAt;m+1<o&&h.push({text:t.slice(m+1,o),startAt:m+1,endAt:o-1})}var v=h.every((function(e){return-1!==r.indexOf(e.text)})),g=0;return h.forEach((function(e){g+=e.text.length})),{isMatched:v,data:{text:e.text,keywords:e.keywords,matchedKeywords:i,noKeywordMatchedLength:g}}}}),Object.defineProperty(r.prototype,"_wordMatch",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=e.text.toLowerCase(),a=this.keywordSeparator||",",n=[];e.keywords.toLowerCase().split(a).forEach((function(e){e.split(" ").forEach((function(e){n.push(e)}))}));var o=t.split(" "),i=o.pop(),c=n.some((function(e){return-1!==e.indexOf(i)}));if(!(c||-1!==r.indexOf(i)))return{isMatched:!1};for(var s=[],u=0,l=0,f=o.filter((function(e){return-1!==n.indexOf(e)}));l<f.length;l++){var h=f[l],d=(p=t.indexOf(h,u))+h.length-1;s.push({text:h,startAt:p,endAt:d}),u=d}if(c){var p=t.indexOf(i,u);s.push({text:i,startAt:p,endAt:p+i.length-1})}var y=o.filter((function(e){return-1===n.indexOf(e)})),b=y.every((function(e){return-1!==r.indexOf(e)})),w=c?0:i.length;return y.forEach((function(e){w+=e.length})),{isMatched:b,data:{text:e.text,keywords:e.keywords,matchedKeywords:s,noKeywordMatchedLength:w}}}}),r}(o),c=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return Object.defineProperty(t,"exactRegExpMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(t,"partialRegExpMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),t}return t(r,e),Object.defineProperty(r.prototype,"loadData",{enumerable:!1,configurable:!0,writable:!0,value:function(t,r){var a=this;e.prototype.loadData.call(this,t,r);var n=new Set;r.forEach((function(e){e.keywords.split(a.keywordSeparator).forEach((function(e){e.length>0&&n.add(e.toLowerCase())}))}));var o=Array.from(n);if(0!==o.length){o.sort((function(e,t){return t.length-e.length})),this.exactRegExpMap.set(t,new RegExp(o.join("|"),"g"));var i=[];o.forEach((function(e){if(e.length>a.minKeywordLength){var t=e.slice(0,a.minKeywordLength),r=[t];(n=e.length-a.minKeywordLength,o=a.minKeywordLength,Array.from(Array(n).keys()).map((function(e){return e+o}))).forEach((function(a){t+=e[a],r.push(t)})),r.reverse(),i.push(r.join("|"))}else e.length>0&&i.push(e);var n,o})),this.partialRegExpMap.set(t,new RegExp(i.join("|"),"g"))}}}),Object.defineProperty(r.prototype,"_match",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=this.data.get(t);if(!r)return[];var a=Array.from(r);if(this.comparator){var n=this.comparator;a.sort((function(r,a){return n(r,a,e,t)}))}return this._keywordMatch(a,e.toLowerCase(),t)}}),Object.defineProperty(r.prototype,"_keywordMatch",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){var a=[],n=this.exactRegExpMap.get(r);if(e&&n){var o=void 0;if(!(o=t.match(n))){var i=this.partialRegExpMap.get(r);i&&(o=t.match(i))}if(o){for(var c=0,s=[],u=0,l=o;u<l.length;u++){var f=l[u],h=t.indexOf(f,c),d=h+f.length-1;s.push({text:f,startAt:h,endAt:d}),c=d}for(var p=function(e){var t=[],r=e.keywords.toLowerCase();s.forEach((function(e){-1!==r.indexOf(e.text)&&t.push(e)})),t.length>0&&a.push({text:e.text,keywords:e.keywords,matchedKeywords:t})},y=0,b=e;y<b.length;y++){p(b[y])}}}return a}}),r}(o),s=function(e){function r(t){var r=e.call(this,t)||this;return Object.defineProperty(r,"matchers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),r.matchers=[],r}return t(r,e),Object.defineProperty(r.prototype,"addMatcherByClass",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=new e({keywordSeparator:this.keywordSeparator,minKeywordLength:this.minKeywordLength,strictMatchLocales:this.strictMatchLocales,comparator:this.comparator,scorer:null,sort:null});this.addMatcher(t)}}),Object.defineProperty(r.prototype,"addMatcher",{enumerable:!1,configurable:!0,writable:!0,value:function(e){"function"==typeof e.loadData&&"function"==typeof e.match&&this.matchers.push(e)}}),Object.defineProperty(r.prototype,"loadData",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=JSON.stringify(t);this.matchers.forEach((function(t){t.loadData(e,JSON.parse(r))}))}}),Object.defineProperty(r.prototype,"_match",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){for(var r=[],a=0,o=this.matchers;a<o.length;a++)for(var i=function(e){var t=r.find((function(t){return t.text===e.text}));if(t){var a=t.matchedKeywords,o=e.matchedKeywords,i=[];a&&a.forEach((function(e){i.some((function(t){return n(e,t)}))||i.push(e)})),o&&o.forEach((function(e){i.some((function(t){return n(e,t)}))||i.push(e)})),i=Array.from(new Set(i)),Object.assign(t,e,{matchedKeywords:i})}else r.push(e)},c=0,s=o[a].match(e,t);c<s.length;c++){i(s[c])}return r}}),r}(o),u=function(e){function r(t){var r=e.call(this,t)||this;return r.addMatcher(new c({keywordSeparator:r.keywordSeparator,minKeywordLength:r.minKeywordLength,strictMatchLocales:r.strictMatchLocales,comparator:r.comparator})),r.addMatcher(new i({keywordSeparator:r.keywordSeparator,minKeywordLength:r.minKeywordLength,strictMatchLocales:r.strictMatchLocales,comparator:r.comparator})),r}return t(r,e),r}(s),l=i,f=function(){function e(e){void 0===e&&(e={keywordSeparator:",",minKeywordLength:2,strictMatchLocales:["en"]}),Object.defineProperty(this,"matcher",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e.matcher?this.matcher=e.matcher:this.matcher=new l({keywordSeparator:e.keywordSeparator||",",minKeywordLength:e.minKeywordLength||2,strictMatchLocales:e.strictMatchLocales||["en"],comparator:e.comparator,filter:e.filter,scorer:e.scorer,sort:e.sort})}return Object.defineProperty(e.prototype,"loadData",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){this._validateLocaleData(t),this.matcher.loadData(e,t)}}),Object.defineProperty(e.prototype,"_validateLocaleData",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(!Array.isArray(e)||!e.every((function(e){return"string"==typeof e.text&&"string"==typeof e.keywords})))throw Error("Locale data should be a list of {text: string, keywords: string}")}}),Object.defineProperty(e.prototype,"generateCompletions",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return!e||e.length<=0?[]:this.matcher.match(e,t)}}),Object.defineProperty(e.prototype,"keywordSeparator",{get:function(){return this.matcher.keywordSeparator},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"minKeywordLength",{get:function(){return this.matcher.minKeywordLength},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"strictMatchLocales",{get:function(){return this.matcher.strictMatchLocales},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this.matcher.data},enumerable:!1,configurable:!0}),e}(),h=function(){function e(e){void 0===e&&(e={apiKey:""}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKeyHeaderName",{enumerable:!0,configurable:!0,writable:!0,value:"X-Secret-Key"}),Object.defineProperty(this,"getEndpoint",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"handleResponse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.apiKey=e.apiKey,e.apiKeyHeaderName&&(this.apiKeyHeaderName=e.apiKeyHeaderName),"function"==typeof e.getEndpoint?this.getEndpoint=e.getEndpoint:this.getEndpoint=function(e){return"/input_completion/".concat(e,"/")},"function"==typeof e.handleResponse?this.handleResponse=e.handleResponse:this.handleResponse=function(e){if("user_says"in e&&Array.isArray(e.user_says))return e.user_says;throw Error("Data should have [user_says](Array<text,keywords>)")}}return Object.defineProperty(e.prototype,"fetch",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this,n=this.getEndpoint(e);return new Promise((function(e,o){return r(t,void 0,void 0,(function(){var t,r,i;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this._fetch(n)];case 1:t=a.sent();try{r=this.handleResponse(t),e(r)}catch(e){o("Invalid data fetched. ".concat(JSON.stringify(t)))}return"user_says"in t&&Array.isArray(t.user_says),[3,3];case 2:return i=a.sent(),o("Failed to fetch data from ".concat(n,".")),console.error(i),[3,3];case 3:return[2]}}))}))}))}}),Object.defineProperty(e.prototype,"_fetch",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this;return new Promise((function(n,o){return r(t,void 0,void 0,(function(){var t,r,i,c,s;return a(this,(function(a){switch(a.label){case 0:return this.isFetchAvailable()?(t={},this.apiKey&&((r={})[this.apiKeyHeaderName]=this.apiKey,t.headers=r),[4,fetch(e,t)]):[3,5];case 1:return(i=a.sent()).ok&&200==i.status?[4,i.json()]:[3,3];case 2:return c=a.sent(),n(c),[3,4];case 3:o("Failed to fetch data. Status: ".concat(i.status)),a.label=4;case 4:return[3,6];case 5:(s=new XMLHttpRequest).open("GET",e),this.apiKey&&s.setRequestHeader(this.apiKeyHeaderName,this.apiKey),s.onload=function(){if(200===s.status)try{var e=JSON.parse(s.response);n(e)}catch(e){o("Invalid response data format.")}else o("Failed to fetch data. Status: ".concat(s.status))},s.onerror=function(){o("Unknown error occurred while fetching completion data.")},s.send(),a.label=6;case 6:return[2]}}))}))}))}}),Object.defineProperty(e.prototype,"isFetchAvailable",{enumerable:!1,configurable:!0,writable:!0,value:function(){return"function"==typeof window.fetch}}),e}();export{s as ConcatMatcher,l as DefaultMatcher,h as Fetcher,i as ForwardMatcher,f as Generator,u as KeywordForwardMatcher,c as KeywordMatcher,o as Matcher};
